#!/bin/csh
#shell to plot RF wiggles from the "grid" files generated by 
#spectral coherence code of J. Park, arranged by BAZ
#Input - $1 - file name $2 file name $3 - scale for R $4 - scale for T
#Experiment with scale!!

rm wigtab? tmp?

echo "EDIT PLOTTING PARAMETERS TO SUIT YOUR DATA"
set BOX = -R-8/25/0/180
set FRAME = -JX8/15

awk '{print $2}' $1 | sort -u > bazlist
foreach i ( `cat bazlist` )
awk '$2 == A && $1 >= -8' A=$i $1 >> wigtabR
awk '$2 == A && $1 >= -8' A=$i $2 >> wigtabT

#in case you decide to demean...
#awk '$2 == A && $1 >= -2' A=$i $1 > tmp1
#set mean = `awk '{a+=$3} END {print a/NR}' tmp1 `
#echo baz $i mean $mean 
#awk '{print $1,$2,$3-mn}' mn=$mean tmp1 >> wigtab

echo ">" >> wigtabR
echo ">" >> wigtabT

end

set scale = $3

gmt pswiggle wigtabR $FRAME $BOX -Z$scale -Gblue -Ba5f1/f10\Swen -P -K > RFwig-epi.ps
gmt pswiggle wigtabR $FRAME $BOX -Z$scale -W1p -N -Gred -P -K -O >>  RFwig-epi.ps

echo 0 2.2 14 0 5 6 $1 scale $3 | gmt pstext $FRAME -R-1/1/-2/2 -N -O -K >> RFwig-epi.ps

gmt psxy $FRAME $BOX -W2p,red -O -K <<END>> RFwig-epi.ps
0 0
0 180
END

#set scale = `echo $scale|awk '{print $1/2}' `
#SOMETIMES it is helpfull to boost T sclae by a factor of 2
set scale = $4

gmt pswiggle wigtabT $FRAME $BOX -Z$scale -Gblue -Ba5f1/a30f10\SWen -P -K -O -X9.5 >> RFwig-epi.ps
gmt pswiggle wigtabT $FRAME $BOX -Z$scale -N -Gred -W1p -P -K -O >>  RFwig-epi.ps
gmt psxy $FRAME $BOX -W2p,red -O -K <<END>> RFwig-epi.ps
0 0
0 180
END

echo 0 2.2 14 0 5 6 $2 scale $scale | gmt pstext $FRAME -R-1/1/-2/2 -N -O >> RFwig-epi.ps

#gmt psconvert RFwig-epi.ps -Tj -A -P
rm -f *.gmt

