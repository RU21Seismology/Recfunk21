#!/bin/csh -f
# runs in GMT 5, converted from GMT4 by YLi (July 2018)

# input an scaling coefficient and station name
#../Plot_bexp outr_cexp.grid outt_cexp.grid 0.15 KEG 

#shell to plot RF wiggles from the "grid" files generated by 
# rfmig_boot.f or rfmig_mboot.f
#Input - $1 - file name (radial) $2 file name (transverse) $3 - scale,   $4 SITE, $5 Fmax, $6 migration depth

rm harmonic-stack-$6km-$5.ps

gmt gmtset PROJ_LENGTH_UNIT inch
gmt gmtset FONT_ANNOT 22p,Helvetica-Bold
gmt gmtset FONT_LABEL 16p,Helvetica-Bold

echo "EDIT PLOTTING PARAMETERS TO SUIT YOUR DATA"
set FRAME = -JX3i/6i
set FRAME_BIG = -JX3i/7i
#set BOX = -R-10/25/-3/53
set BOX = -R0/25/-3/53
set scale = $3

gmt psxy $FRAME $BOX -W1.5p,green  -K -P <<END >! plot.ps
-20 -10
-20 70
END

gmt psxy $FRAME $BOX -W1.5p,green  -O -K -P <<END >> plot.ps
-15 -10
-15 70
END

gmt psxy $FRAME $BOX -W1.5p,green  -O -K -P <<END >> plot.ps
-10 -10
-10 70
END
gmt psxy $FRAME $BOX -W1.5p,green  -O -K -P <<END >> plot.ps
-5 -10
-5 70
END

gmt psxy $FRAME $BOX -W1.5p,green  -O -K -P <<END >> plot.ps
0 -10
0 70
END

gmt psxy $FRAME $BOX -W1.5p,green -O -K -P <<END >> plot.ps
5.0 -10
5.0 70
END

gmt psxy $FRAME $BOX -W1.5p,green -O -K -P <<END >> plot.ps
10 -10
10 70
END

gmt psxy $FRAME $BOX -W1.5p,green -O -K -P <<END >> plot.ps
15.0 -10
15.0 70
END

gmt psxy $FRAME $BOX -W1.5p,green -O -K -P <<END >> plot.ps
20.0 -10
20.0 70
END


gmt pswiggle $1 $FRAME $BOX -Z$scale -G+blue -Ba10f1:'Delay Time (sec)'::'.Anisotropy/Dip':/f32:'Back Azimuth Expansion Terms':/SWen -P -K -O >> plot.ps

gmt pswiggle $1 $FRAME $BOX -Z$scale -G-red -Ba10f1/f32/Swen -P -K -O  >> plot.ps

echo 19 42 constant | gmt pstext $FRAME -R -F+f16p,Helvetica-Bold -N -O -K >> plot.ps
echo 19 32 "cos(baz)" | gmt pstext $FRAME -R -F+f16p,Helvetica-Bold -N -O -K >> plot.ps
echo 19 22 "sin(baz)" | gmt pstext $FRAME -R -F+f16p,Helvetica-Bold -N -O -K >> plot.ps
echo 19 12 "cos(2*baz)" | gmt pstext $FRAME -R -F+f16p,Helvetica-Bold -N -O -K >> plot.ps
echo 19 2  "sin(2*baz)" | gmt pstext $FRAME -R -F+f16p,Helvetica-Bold -N -O -K >> plot.ps

gmt pswiggle $1 $FRAME $BOX -Z$scale -W1p  -P -K -O >>  plot.ps

gmt psxy $FRAME $BOX -W1.5p,green  -O -K -P -X3.5 <<END >> plot.ps
-20 -10
-20 70
END

gmt psxy $FRAME $BOX -W1.5p,green  -O -K -P <<END >> plot.ps
-15 -10
-15 70
END

gmt psxy $FRAME $BOX -W1.5p,green  -O -K -P <<END >> plot.ps
-10 -10
-10 70
END
gmt psxy $FRAME $BOX -W1.5p,green  -O -K -P <<END >> plot.ps
-5 -10
-5 70
END

gmt psxy $FRAME $BOX -W1.5p,green  -O -K -P <<END >> plot.ps
0 -10
0 70
END

gmt psxy $FRAME $BOX -W1.5p,green -O -K -P <<END >> plot.ps
5.0 -10
5.0 70
END

gmt psxy $FRAME $BOX -W1.5p,green -O -K -P <<END >> plot.ps
10 -10
10 70
END

gmt psxy $FRAME $BOX -W1.5p,green -O -K -P <<END >> plot.ps
15.0 -10
15.0 70
END

gmt psxy $FRAME $BOX -W1.5p,green -O -K -P <<END >> plot.ps
20.0 -10
20.0 70
END

gmt pswiggle $2 $FRAME $BOX -Z$scale -G+blue -Ba10f1:'Delay Time (sec)'::'.Unmodelled':/f32:'Back Azimuth Expansion Terms':/SwEn -P -O -K  >> plot.ps

gmt pswiggle $2 $FRAME $BOX -Z$scale -G-red -Ba10f1/f32/SwEn -P -K -O  >> plot.ps

echo 19 42 constant | gmt pstext $FRAME -R -F+f16p,Helvetica-Bold -N -O -K >> plot.ps
echo 19 32 "cos(baz)" | gmt pstext $FRAME -R -F+f16p,Helvetica-Bold -N -O -K >> plot.ps
echo 19 22 "sin(baz)" | gmt pstext $FRAME -R -F+f16p,Helvetica-Bold -N -O -K >> plot.ps
echo 19 12 "cos(2*baz)" | gmt pstext $FRAME -R -F+f16p,Helvetica-Bold -N -O -K >> plot.ps
echo 19 2  "sin(2*baz)" | gmt pstext $FRAME -R -F+f16p,Helvetica-Bold -N -O -K >> plot.ps

gmt pswiggle $2 $FRAME $BOX -Z$scale -W1p -P -O >>  plot.ps

#echo -1.2 2.25 $4-$6km-$5 | gmt pstext $FRAME_BIG -R-1/1/-2/2 -F+f30p,Helvetica-Bold -N -O >> plot.ps

rm -f .gmt*

#mv plot.ps harmonic-stack-$6km-$5-$3.ps
mv plot.ps $4\_$5_harmonic-stack\_$6km.ps

